<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RUNPOLLS | Voter Dashboard</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <!-- Chart.js -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="Voter-dashboard.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="logo-container">
       <img class="logo" src="images/Logo.png" width="150px">
        <i class="bi bi-x-lg" id="close"></i>
      </div>

      <div class="profile-container">
        <!-- Improved profile image container -->
        <div class="profile-image-container" id="sidebarProfileContainer">
          <img
            src="/api/placeholder/70/70"
            class="profile-image"
            id="userProfileImage"
          />
          <div class="edit-icon">
            <i class="bi bi-pencil-fill text-white" style="font-size: 12px"></i>
          </div>
        </div>
        <div class="profile-name" id="userProfileName">Isaiah Durojaiye</div>
        <div class="profile-role" id="userProfileRole">Student Voter</div>
      </div>

      <!-- Sidebar Navigation with improved structure -->
      <div class="sidebar-nav">
        <ul class="nav flex-column nav-main">
          <li class="nav-item">
            <a href="Voter-dashboard.html" class="nav-link active">
              <i class="bi bi-grid-1x2-fill"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="election-page.html" class="nav-link">
              <i class="bi bi-check2-square"></i> Vote
            </a>
          </li>
          <!-- New Navigation Item -->
          <li class="nav-item">
            <a href="Voter-guidline.html" class="nav-link">
              <i class="bi bi-journal-text"></i> Voters Guideline
            </a>
          </li>
          <li class="nav-item">
            <a href="profile-settings.html" class="nav-link">
              <i class="bi bi-gear-fill"></i> Profile Settings
            </a>
          </li>
        </ul>

        <!-- Logout button in footer section -->
        <ul class="nav flex-column nav-footer">
          <li class="nav-item">
            <a href="Login.html" class="nav-link text-danger">
              <i class="bi bi-box-arrow-right"></i> Log out
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Top Navbar -->
      <div class="top-navbar">
        <button class="toggle-sidebar" id="toggleSidebar">
          <i class="bi bi-list"></i>
        </button>

        <div class="search-bar position-relative">
          <i class="bi bi-search search-icon"></i>
          <input
            type="text"
            class="form-control search-input"
            placeholder="Search..."
          />
        </div>

        <div class="user-actions">
          <a href="notifications.html">
            <div class="action-icon" title="Notifications">
            <i class="bi bi-bell"></i>
          </a>
          </div>
          <div class="action-icon" title="Help">
            <i class="bi bi-question-circle"></i>
          </div>
          <!-- Improved navbar user container -->
          <div class="navbar-user-container" id="navbarUserContainer">
            <img
              src="/api/placeholder/40/40"
              class="user-avatar"
              id="navbarUserImage"
            />
            <div class="status-indicator"></div>
          </div>
        </div>
      </div>

      <!-- Welcome Message -->
      <div class="mb-4">
        <h2>Hello, Juan!</h2>
        <p class="text-muted">Welcome to RUN's Online Voting System</p>
      </div>

      <!-- New Become a Candidate Banner -->
      <div class="become-candidate-banner">
        <div>
          <h4>Want to make a difference?</h4>
          <p>
            Run for a position in the Student Council elections and represent
            your peers.
          </p>
        </div>
        <a href="candidate.html">
          <button class="become-candidate-btn" id="becomeCandidateBtn">
            <i class="bi bi-person-badge me-2"></i>Become a Candidate
          </button>
        </a>
      </div>

      <div class="row">
        <!-- Ongoing Elections -->
        <div class="col-lg-6 mb-4">
          <div class="card h-100">
            <div class="card-header">Ongoing Elections</div>
            <div class="card-body">
              <div class="election-card">
                <div class="election-info">
                  <h4>President Student Council</h4>
                  <button class="btn vote-btn">Vote now</button>
                </div>
                <img
                  src="images/Voting-amico.png"
                  alt="Election"
                  class="election-image"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Calendar -->
        <div class="col-lg-6 mb-4">
          <div class="card h-100">
            <div class="card-header">Calendar</div>
            <div class="card-body">
              <div class="calendar-header">
                <div class="today-indicator">Today</div>
                <div class="calendar-navigation">
                  <button class="nav-btn">Next week</button>
                  <button class="nav-btn">This Month</button>
                </div>
              </div>

              <div class="calendar-dates d-flex">
                <div class="date-pill">
                  <span class="day">Mon</span>
                  <span class="date">20</span>
                </div>
                <div class="date-pill">
                  <span class="day">Tue</span>
                  <span class="date">21</span>
                </div>
                <div class="date-pill active">
                  <span class="day">Wed</span>
                  <span class="date">22</span>
                </div>
                <div class="date-pill">
                  <span class="day">Thu</span>
                  <span class="date">23</span>
                </div>
                <div class="date-pill">
                  <span class="day">Fri</span>
                  <span class="date">24</span>
                </div>
              </div>

              <div class="calendar-event">
                <div class="event-color"></div>
                <div>President Student Council</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Live Results -->
        <div class="col-lg-6 mb-4">
          <div class="card h-100">
            <div class="card-header">
              <div class="d-flex align-items-center">
                <a href="#" class="back-btn"
                  ><i class="bi bi-chevron-left"></i
                ></a>
                <span>President Student Council</span>
                <i class="bi bi-chevron-right ms-auto"></i>
              </div>
            </div>
            <div class="card-body">
              <!-- Stats row -->
              <div class="stats-row">
                <div class="stat-item">
                  <div class="stat-value">3</div>
                  <div class="stat-label">Candidates</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">200</div>
                  <div class="stat-label">Total Votes</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">57%</div>
                  <div class="stat-label">Turnout</div>
                </div>
              </div>

              <!-- Tabs -->
              <div class="card-tabs">
                <div class="card-tab active">Results</div>
                <div class="card-tab">Chart View</div>
              </div>

              <!-- Candidates list with progress bars -->
              <div id="candidates-container">
                <!-- Candidate 1 -->
                <div class="candidate-item leading">
                  <div class="candidate-avatar">
                    <i class="bi bi-person"></i>
                  </div>
                  <div class="candidate-info">
                    <div class="candidate-name">
                      Candidate #1
                      <span class="leading-indicator">Leading</span>
                    </div>
                    <div class="vote-count">112 votes</div>
                    <div class="progress-container">
                      <div
                        class="progress-bar"
                        style="
                          width: 56%;
                          background-color: rgba(73, 84, 184, 0.8);
                        "
                      ></div>
                    </div>
                  </div>
                  <div class="vote-percentage">56%</div>
                </div>

                <!-- Candidate 2 -->
                <div class="candidate-item">
                  <div class="candidate-avatar">
                    <i class="bi bi-person"></i>
                  </div>
                  <div class="candidate-info">
                    <div class="candidate-name">Candidate #2</div>
                    <div class="vote-count">68 votes</div>
                    <div class="progress-container">
                      <div
                        class="progress-bar"
                        style="
                          width: 34%;
                          background-color: rgba(73, 84, 184, 0.6);
                        "
                      ></div>
                    </div>
                  </div>
                  <div class="vote-percentage">34%</div>
                </div>

                <!-- Candidate 3 -->
                <div class="candidate-item">
                  <div class="candidate-avatar">
                    <i class="bi bi-person"></i>
                  </div>
                  <div class="candidate-info">
                    <div class="candidate-name">Candidate #3</div>
                    <div class="vote-count">20 votes</div>
                    <div class="progress-container">
                      <div
                        class="progress-bar"
                        style="
                          width: 10%;
                          background-color: rgba(73, 84, 184, 0.4);
                        "
                      ></div>
                    </div>
                  </div>
                  <div class="vote-percentage">10%</div>
                </div>
              </div>

              <!-- Charts container (hidden initially) -->
              <div class="results-chart-container" style="display: none">
                <canvas id="resultsChart"></canvas>
              </div>

              <div class="timestamp">
                Last updated: April 30, 2025 • 10:45 AM
              </div>

              <button class="vote-now-button">VOTE NOW</button>

              <div class="small-note">
                *The candidate list is not in any particular order. Results are
                updated in real-time.
              </div>
            </div>
          </div>
        </div>

        <!-- Voting Process -->
        <div class="col-lg-6 mb-4">
          <div class="card h-100">
            <div class="card-header">
              <div class="d-flex align-items-center">
                <a href="#" class="back-btn"
                  ><i class="bi bi-chevron-left"></i
                ></a>
                <span>Voting Process</span>
                <i class="bi bi-chevron-right ms-auto"></i>
              </div>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="stat-circle" id="registeredVotersChart"></div>
                  <div class="stat-text">
                    <div class="stat-number">562</div>
                  </div>
                  <div class="stat-label">
                    Total number of registered voters
                  </div>
                </div>

                <div class="col-md-4 mb-3">
                  <div class="stat-circle" id="totalVotesChart"></div>
                  <div class="stat-text">
                    <div class="stat-number">312</div>
                  </div>
                  <div class="stat-label">Total number of votes</div>
                </div>

                <div class="col-md-4 mb-3">
                  <div class="stat-circle" id="candidatesChart"></div>
                  <div class="stat-text">
                    <div class="stat-number">3</div>
                  </div>
                  <div class="stat-label">
                    Total number of registered candidates
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Election Activities -->
        <div class="col-lg-12">
          <div class="card">
            <div class="card-header">Election Activities</div>
            <div class="card-body">
              <div class="activity-item">
                <div class="activity-status status-ongoing"></div>
                <div class="activity-details">
                  <div class="activity-name">President Student Council</div>
                </div>
                <span class="activity-label label-ongoing">Ongoing</span>
              </div>

              <div class="activity-item">
                <div class="activity-status status-pending"></div>
                <div class="activity-details">
                  <div class="activity-name">
                    Vice President Student Council
                  </div>
                </div>
                <div class="activity-date"></div>
                <span class="activity-label label-pending">Upcoming</span>
              </div>

              <div class="activity-item">
                <div class="activity-status status-concluded"></div>
                <div class="activity-details">
                  <div class="activity-name">Secretary Student Council</div>
                </div>
                <div class="activity-date"></div>
                <span class="activity-label label-concluded">Concluded</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div
      class="modal fade help-modal"
      id="helpModal"
      tabindex="-1"
      aria-labelledby="helpModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5
              class="modal-title d-flex align-items-center"
              id="helpModalLabel"
            >
              <i class="bi bi-headset me-2"></i>
              Need Help? We're Here for You!
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Contact Methods -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="bi bi-telephone-fill me-2"></i>Contact Our Support
                Team
              </h6>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="card contact-card p-3 text-center">
                    <div class="contact-icon phone-icon mx-auto">
                      <i class="bi bi-telephone-fill"></i>
                    </div>
                    <h6 class="fw-bold">Phone Support</h6>
                    <p class="text-muted mb-2">
                      Call us directly for immediate assistance
                    </p>
                    <p class="fw-bold text-success mb-0">+234 803 123 4567</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card contact-card p-3 text-center">
                    <div class="contact-icon email-icon mx-auto">
                      <i class="bi bi-envelope-fill"></i>
                    </div>
                    <h6 class="fw-bold">Email Support</h6>
                    <p class="text-muted mb-2">
                      Send us detailed questions anytime
                    </p>
                    <p class="fw-bold text-primary mb-0">
                      support@runpolls.edu.ng
                    </p>
                  </div>
                </div>

            <!-- Emergency Contact -->
            <div class="alert alert-warning mb-4">
              <h6 class="alert-heading">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>Emergency
                Support
              </h6>
              <p class="mb-1">
                For urgent election-related issues during voting periods:
              </p>
              <p class="mb-0">
                <strong>Emergency Hotline:</strong> +234 805 987 6543
              </p>
              <small>Available 24/7 during active election periods only</small>
            </div>

            <!-- FAQ Section -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="bi bi-question-circle-fill me-2"></i>Frequently Asked
                Questions
              </h6>
              <div class="faq-item">
                <div class="faq-question">How do I reset my password?</div>
                <div class="faq-answer">
                  Click on "Forgot Password" on the login page and follow the
                  instructions sent to your registered email.
                </div>
              </div>
              <div class="faq-item">
                <div class="faq-question">
                  Can I change my vote after submitting?
                </div>
                <div class="faq-answer">
                  No, votes are final once submitted. Please review your choices
                  carefully before confirming.
                </div>
              </div>
              <div class="faq-item">
                <div class="faq-question">
                  What if I'm having trouble logging in?
                </div>
                <div class="faq-answer">
                  Ensure you're using your correct Student ID and password.
                  Clear your browser cache or try a different browser. If issues
                  persist, contact support.
                </div>
              </div>
              <div class="faq-item">
                <div class="faq-question">
                  How do I update my profile information?
                </div>
                <div class="faq-answer">
                  You can update your profile from the Profile Settings page.
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap & Other JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
      // Help Modal Implementation
document.addEventListener("DOMContentLoaded", function () {
  // Initialize help modal
  const helpModal = new bootstrap.Modal(document.getElementById("helpModal"));
  
  // Get help icon - it's in the user-actions div with question-circle class
  const helpIcon = document.querySelector('.action-icon[title="Help"]');
  
  // Help icon click handler
  if (helpIcon) {
    helpIcon.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      console.log("Help icon clicked");
      helpModal.show();
    });
    
    // Add pointer cursor to help icon
    helpIcon.style.cursor = "pointer";
  }

  // Additional event handlers for modal
  const helpModalElement = document.getElementById("helpModal");
  
  if (helpModalElement) {
    // Modal shown event
    helpModalElement.addEventListener("shown.bs.modal", function () {
      console.log("Help modal opened");
    });

    // Modal hidden event
    helpModalElement.addEventListener("hidden.bs.modal", function () {
      console.log("Help modal closed");
    });

    // Handle ESC key press to close modal
    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape" && helpModalElement.classList.contains("show")) {
        helpModal.hide();
      }
    });
  }

  // FAQ accordion functionality (if you want expandable FAQ items)
  const faqItems = document.querySelectorAll('.faq-item');
  
  faqItems.forEach(item => {
    const question = item.querySelector('.faq-question');
    const answer = item.querySelector('.faq-answer');
    
    if (question && answer) {
      // Initially hide answers
      answer.style.display = 'none';
      question.style.cursor = 'pointer';
      
      // Add click handler to questions
      question.addEventListener('click', function() {
        const isVisible = answer.style.display === 'block';
        
        // Hide all other answers first
        faqItems.forEach(otherItem => {
          const otherAnswer = otherItem.querySelector('.faq-answer');
          if (otherAnswer && otherAnswer !== answer) {
            otherAnswer.style.display = 'none';
            otherItem.querySelector('.faq-question').classList.remove('active');
          }
        });
        
        // Toggle current answer
        if (isVisible) {
          answer.style.display = 'none';
          question.classList.remove('active');
        } else {
          answer.style.display = 'block';
          question.classList.add('active');
        }
      });
    }
  });

  // Contact card click handlers (optional - for better UX)
  const phoneCard = document.querySelector('.contact-card .phone-icon').closest('.contact-card');
  const emailCard = document.querySelector('.contact-card .email-icon').closest('.contact-card');
  
  if (phoneCard) {
    phoneCard.addEventListener('click', function() {
      const phoneNumber = this.querySelector('.text-success').textContent;
      window.location.href = `tel:${phoneNumber}`;
    });
    phoneCard.style.cursor = 'pointer';
  }
  
  if (emailCard) {
    emailCard.addEventListener('click', function() {
      const email = this.querySelector('.text-primary').textContent;
      window.location.href = `mailto:${email}`;
    });
    emailCard.style.cursor = 'pointer';
  }

  // Initialize tooltips for the help section
  const tooltipTriggerList = [].slice.call(
    document.querySelectorAll('[data-bs-toggle="tooltip"]')
  );
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  console.log("Help modal functionality initialized");
});

// Alternative method if the above doesn't work due to timing issues
function initializeHelpModal() {
  const helpModal = new bootstrap.Modal(document.getElementById("helpModal"));
  const helpIcon = document.querySelector('.action-icon[title="Help"]');
  
  if (helpIcon) {
    helpIcon.onclick = function(e) {
      e.preventDefault();
      helpModal.show();
    };
  }
}

 document.addEventListener("DOMContentLoaded", function () {
        // Initialize profile containers
        const sidebarProfileContainer = document.getElementById(
          "sidebarProfileContainer"
        );
        const navbarUserContainer = document.getElementById(
          "navbarUserContainer"
        );

        // Function to show profile image or default user icon
        function updateProfileDisplays(imageUrl) {
          // Clear existing sidebar container
          sidebarProfileContainer.innerHTML = "";
          navbarUserContainer.innerHTML = "";

          if (imageUrl) {
            // Sidebar profile image
            const sidebarImg = document.createElement("img");
            sidebarImg.src = imageUrl;
            sidebarImg.alt = "Profile";
            sidebarImg.className = "profile-image";
            sidebarImg.id = "userProfileImage";
            sidebarImg.style.borderRadius = "50%";
            sidebarImg.style.width = "100%";
            sidebarImg.style.height = "100%";
            sidebarImg.style.objectFit = "cover";
            sidebarProfileContainer.appendChild(sidebarImg);

            // Add edit icon to sidebar profile
            const editIcon = document.createElement("div");
            editIcon.className = "edit-icon";
            editIcon.innerHTML =
              '<i class="bi bi-pencil-fill text-white" style="font-size: 12px;"></i>';
            sidebarProfileContainer.appendChild(editIcon);

            // Navbar profile image
            const navbarImg = document.createElement("img");
            navbarImg.src = imageUrl;
            navbarImg.alt = "User";
            navbarImg.className = "user-avatar";
            navbarImg.id = "navbarUserImage";
            navbarImg.style.borderRadius = "50%";
            navbarImg.style.width = "100%";
            navbarImg.style.height = "100%";
            navbarImg.style.objectFit = "cover";
            navbarUserContainer.appendChild(navbarImg);

            // Add status indicator to navbar
            const statusIndicator = document.createElement("div");
            statusIndicator.className = "status-indicator";
            navbarUserContainer.appendChild(statusIndicator);
          } else {
            // Sidebar profile icon - default user icon
            const sidebarIcon = document.createElement("div");
            sidebarIcon.className = "default-user-icon";
            sidebarIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="#888888" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                `;
            sidebarProfileContainer.appendChild(sidebarIcon);

            // Add edit icon to sidebar profile
            const editIcon = document.createElement("div");
            editIcon.className = "edit-icon";
            editIcon.innerHTML =
              '<i class="bi bi-pencil-fill text-white" style="font-size: 12px;"></i>';
            sidebarProfileContainer.appendChild(editIcon);

            // Navbar profile icon - default user icon
            const navbarIcon = document.createElement("div");
            navbarIcon.className = "default-user-icon";
            navbarIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="#888888" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                `;
            navbarUserContainer.appendChild(navbarIcon);

            // Add status indicator to navbar
            const statusIndicator = document.createElement("div");
            statusIndicator.className = "status-indicator";
            navbarUserContainer.appendChild(statusIndicator);
          }

          // If modal is open, update modal profile image as well
          const modalProfileContainer = document.getElementById(
            "modalProfileContainer"
          );
          if (modalProfileContainer) {
            updateModalProfileImage(modalProfileContainer, imageUrl);
          }
        }

        // Function to update modal profile image
        function updateModalProfileImage(container, imageUrl) {
          container.innerHTML = "";

          if (imageUrl) {
            const img = document.createElement("img");
            img.src = imageUrl;
            img.alt = "Profile";
            img.style.width = "100%";
            img.style.height = "100%";
            img.style.objectFit = "cover";
            img.style.borderRadius = "50%";
            container.appendChild(img);
          } else {
            container.innerHTML = `
                    <div class="default-user-icon" style="width: 100%; height: 100%; background-color: #e9ecef; border-radius: 50%;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 80%; height: 80%; margin: 10%;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                `;
          }
        }

        // Helper function to show alerts
        function showAlert(message, type) {
          const alertDiv = document.createElement("div");
          alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
          alertDiv.role = "alert";
          alertDiv.style.position = "fixed";
          alertDiv.style.top = "20px";
          alertDiv.style.right = "20px";
          alertDiv.style.zIndex = "9999";
          alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;

          document.body.appendChild(alertDiv);

          // Auto dismiss after 3 seconds
          setTimeout(() => {
            if (alertDiv.parentNode) {
              const bsAlert = new bootstrap.Alert(alertDiv);
              bsAlert.close();
            }
          }, 3000);
        }

        // Load user profile data including image
        try {
          const user = JSON.parse(localStorage.getItem("currentUser")) || {};

          // Update profile name
          if (user.firstName && user.lastName) {
            document.getElementById(
              "userProfileName"
            ).textContent = `${user.firstName} ${user.lastName}`;
            // Update welcome message
            const welcomeHeading = document.querySelector("h2");
            if (
              welcomeHeading &&
              welcomeHeading.textContent.includes("Hello")
            ) {
              welcomeHeading.textContent = `Hello, ${user.firstName}!`;
            }
          }

          // Update profile role if exists
          if (user.role) {
            document.getElementById("userProfileRole").textContent = user.role;
          }

          // Update profile images
          updateProfileDisplays(user.profileImage);
        } catch (error) {
          console.error("Error loading user profile:", error);
          updateProfileDisplays(null);
        }

        // Create profile edit modal with upload and remove functionality
        function createProfileEditModal() {
          // Modal HTML structure
          const modalHTML = `
                <div class="modal fade" id="profileEditModal" tabindex="-1" aria-labelledby="profileEditModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="profileEditModalLabel">View Profile Picture</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <div class="mb-4">
                                    <div class="position-relative d-inline-block">
                                        <div id="modalProfileContainer" class="rounded-circle overflow-hidden" style="width: 150px; height: 150px;">
                                            <!-- Image will be inserted here -->
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <button id="modalUploadBtn" class="btn btn-success btn-sm rounded-pill px-4" style="display: none;">UPLOAD</button>
                                    <button id="modalRemoveBtn" class="btn btn-danger btn-sm rounded-pill px-4 ms-2" style="display: none;">REMOVE</button>
                                </div>
                                <p class="text-muted small">Go to Profile Settings to change your profile picture</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

          // Append modal to body
          const modalDiv = document.createElement("div");
          modalDiv.innerHTML = modalHTML;
          document.body.appendChild(modalDiv);

          // Get current user data
          const user = JSON.parse(localStorage.getItem("currentUser")) || {};

          // Update modal profile container with current image or default icon
          const modalProfileContainer = document.getElementById(
            "modalProfileContainer"
          );
          updateModalProfileImage(modalProfileContainer, user.profileImage);

          // Handle upload button click in modal
          document
            .getElementById("modalUploadBtn")
            .addEventListener("click", function () {
              // Create file input element
              const fileInput = document.createElement("input");
              fileInput.type = "file";
              fileInput.accept = "image/*";
              fileInput.style.display = "none";
              document.body.appendChild(fileInput);

              // Trigger file selection
              fileInput.click();

              // Handle file selection
              fileInput.addEventListener("change", function () {
                if (this.files && this.files[0]) {
                  const reader = new FileReader();

                  reader.onload = function (e) {
                    const imageResult = e.target.result;

                    // Update modal image
                    updateModalProfileImage(modalProfileContainer, imageResult);

                    // Update profile images on page
                    updateProfileDisplays(imageResult);

                    // Store image in localStorage
                    try {
                      let user =
                        JSON.parse(localStorage.getItem("currentUser")) || {};
                      user.profileImage = imageResult;
                      localStorage.setItem("currentUser", JSON.stringify(user));

                      // Show success message
                      showAlert(
                        "Profile picture updated successfully!",
                        "success"
                      );
                    } catch (error) {
                      console.error("Error saving profile image:", error);
                      showAlert(
                        "Error saving profile image. Please try again.",
                        "danger"
                      );
                    }
                  };

                  reader.readAsDataURL(this.files[0]);
                }

                // Clean up
                document.body.removeChild(fileInput);
              });
            });

          // Handle remove button click in modal
          document
            .getElementById("modalRemoveBtn")
            .addEventListener("click", function () {
              // Update both modal and page with default icons
              updateModalProfileImage(modalProfileContainer, null);
              updateProfileDisplays(null);

              // Remove image from storage
              try {
                let user =
                  JSON.parse(localStorage.getItem("currentUser")) || {};
                delete user.profileImage;
                localStorage.setItem("currentUser", JSON.stringify(user));

                // Show success message
                showAlert("Profile picture removed successfully!", "success");
              } catch (error) {
                console.error("Error removing profile image:", error);
                showAlert(
                  "Error removing profile image. Please try again.",
                  "danger"
                );
              }
            });

          return new bootstrap.Modal(
            document.getElementById("profileEditModal")
          );
        }

        // Add profile edit functionality to both sidebar and navbar profile images
        const profileElements = [sidebarProfileContainer, navbarUserContainer];

        profileElements.forEach((element) => {
          element.style.cursor = "pointer";
          element.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Create and show the modal
            const profileModal = createProfileEditModal();
            profileModal.show();

            // Clean up when modal is hidden
            document
              .getElementById("profileEditModal")
              .addEventListener("hidden.bs.modal", function () {
                if (this.parentNode) {
                  document.body.removeChild(this.parentNode);
                }
              });
          });
        });

        // Toggle Sidebar
        document
          .getElementById("toggleSidebar")
          .addEventListener("click", function () {
            document.getElementById("sidebar").classList.toggle("active");
          });
        document.getElementById("close").addEventListener("click", function () {
          document.getElementById("sidebar").classList.remove("active");
        });

        // Initialize Charts
        // Registered Voters Chart
        const registeredVotersChart = new Chart(
          document.createElement("canvas"),
          {
            type: "doughnut",
            data: {
              datasets: [
                {
                  data: [562, 0],
                  backgroundColor: ["#4954b8", "#e9ecef"],
                  borderWidth: 0,
                },
              ],
            },
            options: {
              cutout: "65%",
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  enabled: false,
                },
              },
            },
          }
        );
        document
          .getElementById("registeredVotersChart")
          .appendChild(registeredVotersChart.canvas);

        // Total Votes Chart
        const totalVotesChart = new Chart(document.createElement("canvas"), {
          type: "doughnut",
          data: {
            datasets: [
              {
                data: [321, 241],
                backgroundColor: ["#4954b8", "#e9ecef"],
                borderWidth: 0,
              },
            ],
          },
          options: {
            cutout: "65%",
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                enabled: false,
              },
            },
          },
        });
        document
          .getElementById("totalVotesChart")
          .appendChild(totalVotesChart.canvas);

        // Candidates Chart
        const candidatesChart = new Chart(document.createElement("canvas"), {
          type: "doughnut",
          data: {
            datasets: [
              {
                data: [3, 10],
                backgroundColor: ["#4954b8", "#e9ecef"],
                borderWidth: 0,
              },
            ],
          },
          options: {
            cutout: "65%",
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                enabled: false,
              },
            },
          },
        });
        document
          .getElementById("candidatesChart")
          .appendChild(candidatesChart.canvas);
      });

      document.addEventListener("DOMContentLoaded", function () {
        // Check if the candidates container and tabs exist on the page
        const candidatesContainer = document.getElementById(
          "candidates-container"
        );
        const chartContainer = document.querySelector(
          ".results-chart-container"
        );
        const tabs = document.querySelectorAll(".card-tab");

        if (candidatesContainer && tabs.length > 0) {
          // Initialize tabs functionality
          tabs.forEach((tab) => {
            tab.addEventListener("click", function () {
              // Remove active class from all tabs
              tabs.forEach((t) => t.classList.remove("active"));

              // Add active class to clicked tab
              this.classList.add("active");

              // Show/hide appropriate content
              if (this.textContent === "Results") {
                candidatesContainer.style.display = "block";
                chartContainer.style.display = "none";
              } else {
                candidatesContainer.style.display = "none";
                chartContainer.style.display = "block";

                // Initialize chart if it's being shown
                initResultsChart();
              }
            });
          });

          // Add animation to progress bars
          setTimeout(() => {
            const progressBars = document.querySelectorAll(
              ".progress-container .progress-bar"
            );
            progressBars.forEach((bar) => {
              const width = bar.style.width;
              bar.style.width = "0%";
              setTimeout(() => {
                bar.style.width = width;
              }, 300);
            });
          }, 500);
        }

        // Function to initialize the candidate results chart
        function initResultsChart() {
          const ctx = document.getElementById("resultsChart");

          // Only proceed if the canvas exists
          if (!ctx) return;

          // Get the context
          const ctxContext = ctx.getContext("2d");

          // Check if chart already exists and destroy it to prevent duplicates
          if (window.resultsChart instanceof Chart) {
            window.resultsChart.destroy();
          }

          // Create new chart
          window.resultsChart = new Chart(ctxContext, {
            type: "bar",
            data: {
              labels: ["Candidate #1", "Candidate #2", "Candidate #3"],
              datasets: [
                {
                  label: "Votes",
                  data: [112, 68, 20],
                  backgroundColor: [
                    "rgba(73, 84, 184, 0.8)",
                    "rgba(73, 84, 184, 0.6)",
                    "rgba(73, 84, 184, 0.4)",
                  ],
                  borderColor: [
                    "rgba(73, 84, 184, 1)",
                    "rgba(73, 84, 184, 1)",
                    "rgba(73, 84, 184, 1)",
                  ],
                  borderWidth: 1,
                  borderRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const value = context.raw;
                      const total = 200; // Total votes
                      const percentage = Math.round((value / total) * 100);
                      return `${value} votes (${percentage}%)`;
                    },
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    display: true,
                    drawBorder: false,
                    color: "rgba(0, 0, 0, 0.05)",
                  },
                },
                x: {
                  grid: {
                    display: false,
                  },
                },
              },
            },
          });
        }
      });

    </script>
  </body>
</html>
